import e from"buffer";import r from"stream";import t from"util";import n from"crypto";var i=({init:e},{env:r,services:t,database:n,getSchema:i})=>{e("middlewares.before",async function({app:e}){console.log("!!! MIDDLEWARE EXTENSION LOADED !!!");const{createOAuthMiddleware:s}=await Promise.resolve().then(function(){return Wi}),o=s({services:t,database:n,getSchema:i,env:r});e.use(o),e.use((e,r,t)=>{const n=r.end;r.end=function(){if(403===r.statusCode&&e.path&&e.path.startsWith("/items")){const r=e.accountability&&e.accountability.user||"anonymous";console.warn("[PERMISSIONS-403]",e.method,e.path,"user:",r)}return n.apply(this,arguments)},t()})})},s={},o={exports:{}};
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
!function(r,t){var n=e,i=n.Buffer;function s(e,r){for(var t in e)r[t]=e[t]}function o(e,r,t){return i(e,r,t)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?r.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,r,t){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,r,t)},o.alloc=function(e,r,t){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==r?"string"==typeof t?n.fill(r,t):n.fill(r):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}}(o,o.exports);var a=o.exports,c=a.Buffer,u=r;function l(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=c.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=c.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}t.inherits(l,u),l.prototype.write=function(e){this.buffer=c.concat([this.buffer,c.from(e)]),this.emit("data",e)},l.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var f=l;function p(e){return(e/8|0)+(e%8==0?0:1)}var h={ES256:p(256),ES384:p(384),ES512:p(521)};var m=function(e){var r=h[e];if(r)return r;throw new Error('Unknown algorithm "'+e+'"')},E=a.Buffer,v=m,d=128;function y(e){if(E.isBuffer(e))return e;if("string"==typeof e)return E.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function g(e,r,t){for(var n=0;r+n<t&&0===e[r+n];)++n;return e[r+n]>=d&&--n,n}var S,w,$={derToJose:function(e,r){e=y(e);var t=v(r),n=t+1,i=e.length,s=0;if(48!==e[s++])throw new Error('Could not find expected "seq"');var o=e[s++];if(129===o&&(o=e[s++]),i-s<o)throw new Error('"seq" specified length of "'+o+'", only "'+(i-s)+'" remaining');if(2!==e[s++])throw new Error('Could not find expected "int" for "r"');var a=e[s++];if(i-s-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(i-s-2)+'" available');if(n<a)throw new Error('"r" specified length of "'+a+'", max of "'+n+'" is acceptable');var c=s;if(s+=a,2!==e[s++])throw new Error('Could not find expected "int" for "s"');var u=e[s++];if(i-s!==u)throw new Error('"s" specified length of "'+u+'", expected "'+(i-s)+'"');if(n<u)throw new Error('"s" specified length of "'+u+'", max of "'+n+'" is acceptable');var l=s;if((s+=u)!==i)throw new Error('Expected to consume entire buffer, but "'+(i-s)+'" bytes remain');var f=t-a,p=t-u,h=E.allocUnsafe(f+a+p+u);for(s=0;s<f;++s)h[s]=0;e.copy(h,s,c+Math.max(-f,0),c+a);for(var m=s=t;s<m+p;++s)h[s]=0;return e.copy(h,s,l+Math.max(-p,0),l+u),h=(h=h.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,r){e=y(e);var t=v(r),n=e.length;if(n!==2*t)throw new TypeError('"'+r+'" signatures must be "'+2*t+'" bytes, saw "'+n+'"');var i=g(e,0,t),s=g(e,t,e.length),o=t-i,a=t-s,c=2+o+1+1+a,u=c<d,l=E.allocUnsafe((u?2:3)+c),f=0;return l[f++]=48,u?l[f++]=c:(l[f++]=129,l[f++]=255&c),l[f++]=2,l[f++]=o,i<0?(l[f++]=0,f+=e.copy(l,f,0,t)):f+=e.copy(l,f,i,t),l[f++]=2,l[f++]=a,s<0?(l[f++]=0,e.copy(l,f,t)):e.copy(l,f,t+s),l}};var b,R=a.Buffer,I=n,O=$,A=t,L="secret must be a string or buffer",N="key must be a string or a buffer",T="function"==typeof I.createPublicKey;function P(e){if(!R.isBuffer(e)&&"string"!=typeof e){if(!T)throw _(N);if("object"!=typeof e)throw _(N);if("string"!=typeof e.type)throw _(N);if("string"!=typeof e.asymmetricKeyType)throw _(N);if("function"!=typeof e.export)throw _(N)}}function j(e){if(!R.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw _("key must be a string, a buffer or an object")}function C(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function D(e){var r=4-(e=e.toString()).length%4;if(4!==r)for(var t=0;t<r;++t)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function _(e){var r=[].slice.call(arguments,1),t=A.format.bind(A,e).apply(null,r);return new TypeError(t)}function M(e){var r;return r=e,R.isBuffer(r)||"string"==typeof r||(e=JSON.stringify(e)),e}function x(e){return function(r,t){!function(e){if(!R.isBuffer(e)){if("string"==typeof e)return e;if(!T)throw _(L);if("object"!=typeof e)throw _(L);if("secret"!==e.type)throw _(L);if("function"!=typeof e.export)throw _(L)}}(t),r=M(r);var n=I.createHmac("sha"+e,t);return C((n.update(r),n.digest("base64")))}}T&&(N+=" or a KeyObject",L+="or a KeyObject");var k="timingSafeEqual"in I?function(e,r){return e.byteLength===r.byteLength&&I.timingSafeEqual(e,r)}:function(r,t){return b||(b=function(){if(w)return S;w=1;var r=e.Buffer,t=e.SlowBuffer;function n(e,t){if(!r.isBuffer(e)||!r.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(var n=0,i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}S=n,n.install=function(){r.prototype.equal=t.prototype.equal=function(e){return n(this,e)}};var i=r.prototype.equal,s=t.prototype.equal;return n.restore=function(){r.prototype.equal=i,t.prototype.equal=s},S}()),b(r,t)};function G(e){return function(r,t,n){var i=x(e)(r,n);return k(R.from(t),R.from(i))}}function F(e){return function(r,t){j(t),r=M(r);var n=I.createSign("RSA-SHA"+e);return C((n.update(r),n.sign(t,"base64")))}}function U(e){return function(r,t,n){P(n),r=M(r),t=D(t);var i=I.createVerify("RSA-SHA"+e);return i.update(r),i.verify(n,t,"base64")}}function B(e){return function(r,t){j(t),r=M(r);var n=I.createSign("RSA-SHA"+e);return C((n.update(r),n.sign({key:t,padding:I.constants.RSA_PKCS1_PSS_PADDING,saltLength:I.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function X(e){return function(r,t,n){P(n),r=M(r),t=D(t);var i=I.createVerify("RSA-SHA"+e);return i.update(r),i.verify({key:n,padding:I.constants.RSA_PKCS1_PSS_PADDING,saltLength:I.constants.RSA_PSS_SALTLEN_DIGEST},t,"base64")}}function H(e){var r=F(e);return function(){var t=r.apply(null,arguments);return t=O.derToJose(t,"ES"+e)}}function K(e){var r=U(e);return function(t,n,i){return n=O.joseToDer(n,"ES"+e).toString("base64"),r(t,n,i)}}function V(){return function(){return""}}function q(){return function(e,r){return""===r}}var W=function(e){var r={hs:x,rs:F,ps:B,es:H,none:V},t={hs:G,rs:U,ps:X,es:K,none:q},n=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!n)throw _('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var i=(n[1]||n[3]).toLowerCase(),s=n[2];return{sign:r[i](s),verify:t[i](s)}},z=e.Buffer,Y=function(e){return"string"==typeof e?e:"number"==typeof e||z.isBuffer(e)?e.toString():JSON.stringify(e)},J=a.Buffer,Z=f,Q=W,ee=r,re=Y,te=t;function ne(e,r){return J.from(e,r).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ie(e){var r=e.header,t=e.payload,n=e.secret||e.privateKey,i=e.encoding,s=Q(r.alg),o=function(e,r,t){t=t||"utf8";var n=ne(re(e),"binary"),i=ne(re(r),t);return te.format("%s.%s",n,i)}(r,t,i),a=s.sign(o,n);return te.format("%s.%s",o,a)}function se(e){var r=e.secret;if(r=null==(r=null==r?e.privateKey:r)?e.key:r,!0===/^hs/i.test(e.header.alg)&&null==r)throw new TypeError("secret must be a string or buffer or a KeyObject");var t=new Z(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new Z(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}te.inherits(se,ee),se.prototype.sign=function(){try{var e=ie({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},se.sign=ie;var oe=se,ae=a.Buffer,ce=f,ue=W,le=r,fe=Y,pe=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function he(e){if(function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function me(e){var r=e.split(".",1)[0];return he(ae.from(r,"base64").toString("binary"))}function Ee(e){return e.split(".")[2]}function ve(e){return pe.test(e)&&!!me(e)}function de(e,r,t){if(!r){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=Ee(e=fe(e)),s=function(e){return e.split(".",2).join(".")}(e);return ue(r).verify(s,i,t)}function ye(e,r){if(r=r||{},!ve(e=fe(e)))return null;var t=me(e);if(!t)return null;var n=function(e,r){r=r||"utf8";var t=e.split(".")[1];return ae.from(t,"base64").toString(r)}(e);return("JWT"===t.typ||r.json)&&(n=JSON.parse(n,r.encoding)),{header:t,payload:n,signature:Ee(e)}}function ge(e){var r=(e=e||{}).secret;if(r=null==(r=null==r?e.publicKey:r)?e.key:r,!0===/^hs/i.test(e.algorithm)&&null==r)throw new TypeError("secret must be a string or buffer or a KeyObject");var t=new ce(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new ce(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}t.inherits(ge,le),ge.prototype.verify=function(){try{var e=de(this.signature.buffer,this.algorithm,this.key.buffer),r=ye(this.signature.buffer,this.encoding);return this.emit("done",e,r),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},ge.decode=ye,ge.isValid=ve,ge.verify=de;var Se=oe,we=ge;s.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],s.sign=Se.sign,s.verify=we.verify,s.decode=we.decode,s.isValid=we.isValid,s.createSign=function(e){return new Se(e)},s.createVerify=function(e){return new we(e)};var $e=s,be=function(e,r){r=r||{};var t=$e.decode(e,r);if(!t)return null;var n=t.payload;if("string"==typeof n)try{var i=JSON.parse(n);null!==i&&"object"==typeof i&&(n=i)}catch(e){}return!0===r.complete?{header:t.header,payload:n,signature:t.signature}:n},Re=function(e,r){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,r&&(this.inner=r)};(Re.prototype=Object.create(Error.prototype)).constructor=Re;var Ie=Re,Oe=Ie,Ae=function(e,r){Oe.call(this,e),this.name="NotBeforeError",this.date=r};(Ae.prototype=Object.create(Oe.prototype)).constructor=Ae;var Le=Ae,Ne=Ie,Te=function(e,r){Ne.call(this,e),this.name="TokenExpiredError",this.expiredAt=r};(Te.prototype=Object.create(Ne.prototype)).constructor=Te;var Pe=Te,je=1e3,Ce=60*je,De=60*Ce,_e=24*De,Me=7*_e,xe=365.25*_e;function ke(e,r,t,n){var i=r>=1.5*t;return Math.round(e/t)+" "+n+(i?"s":"")}var Ge=function(e,r){r=r||{};var t=typeof e;if("string"===t&&e.length>0)return function(e){if((e=String(e)).length>100)return;var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!r)return;var t=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return t*xe;case"weeks":case"week":case"w":return t*Me;case"days":case"day":case"d":return t*_e;case"hours":case"hour":case"hrs":case"hr":case"h":return t*De;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ce;case"seconds":case"second":case"secs":case"sec":case"s":return t*je;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}(e);if("number"===t&&isFinite(e))return r.long?function(e){var r=Math.abs(e);if(r>=_e)return ke(e,r,_e,"day");if(r>=De)return ke(e,r,De,"hour");if(r>=Ce)return ke(e,r,Ce,"minute");if(r>=je)return ke(e,r,je,"second");return e+" ms"}(e):function(e){var r=Math.abs(e);if(r>=_e)return Math.round(e/_e)+"d";if(r>=De)return Math.round(e/De)+"h";if(r>=Ce)return Math.round(e/Ce)+"m";if(r>=je)return Math.round(e/je)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},Fe=function(e,r){var t=r||Math.floor(Date.now()/1e3);if("string"==typeof e){var n=Ge(e);if(void 0===n)return;return Math.floor(t+n/1e3)}return"number"==typeof e?t+e:void 0},Ue={exports:{}};var Be={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var Xe="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,r){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=Be,s=Xe,o=(r=e.exports={}).re=[],a=r.safeRe=[],c=r.src=[],u=r.safeSrc=[],l=r.t={};let f=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[p,n]],m=(e,r,t)=>{const n=(e=>{for(const[r,t]of h)e=e.split(`${r}*`).join(`${r}{0,${t}}`).split(`${r}+`).join(`${r}{1,${t}}`);return e})(r),i=f++;s(e,i,r),l[e]=i,c[i]=r,u[i]=n,o[i]=new RegExp(r,t?"g":void 0),a[i]=new RegExp(n,t?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),m("FULL",`^${c[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),m("LOOSE",`^${c[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),m("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?`+`(?:${c[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[l.COERCE],!0),m("COERCERTLFULL",c[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",m("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",m("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Ue,Ue.exports);var He=Ue.exports;const Ke=Object.freeze({loose:!0}),Ve=Object.freeze({});var qe=e=>e?"object"!=typeof e?Ke:e:Ve;const We=/^[0-9]+$/,ze=(e,r)=>{if("number"==typeof e&&"number"==typeof r)return e===r?0:e<r?-1:1;const t=We.test(e),n=We.test(r);return t&&n&&(e=+e,r=+r),e===r?0:t&&!n?-1:n&&!t?1:e<r?-1:1};var Ye={compareIdentifiers:ze,rcompareIdentifiers:(e,r)=>ze(r,e)};const Je=Xe,{MAX_LENGTH:Ze,MAX_SAFE_INTEGER:Qe}=Be,{safeRe:er,t:rr}=He,tr=qe,{compareIdentifiers:nr}=Ye;var ir=class e{constructor(r,t){if(t=tr(t),r instanceof e){if(r.loose===!!t.loose&&r.includePrerelease===!!t.includePrerelease)return r;r=r.version}else if("string"!=typeof r)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof r}".`);if(r.length>Ze)throw new TypeError(`version is longer than ${Ze} characters`);Je("SemVer",r,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=r.trim().match(t.loose?er[rr.LOOSE]:er[rr.FULL]);if(!n)throw new TypeError(`Invalid Version: ${r}`);if(this.raw=r,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Qe||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Qe||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Qe||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const r=+e;if(r>=0&&r<Qe)return r}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(r){if(Je("SemVer.compare",this.version,this.options,r),!(r instanceof e)){if("string"==typeof r&&r===this.version)return 0;r=new e(r,this.options)}return r.version===this.version?0:this.compareMain(r)||this.comparePre(r)}compareMain(r){return r instanceof e||(r=new e(r,this.options)),this.major<r.major?-1:this.major>r.major?1:this.minor<r.minor?-1:this.minor>r.minor?1:this.patch<r.patch?-1:this.patch>r.patch?1:0}comparePre(r){if(r instanceof e||(r=new e(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;let t=0;do{const e=this.prerelease[t],n=r.prerelease[t];if(Je("prerelease compare",t,e,n),void 0===e&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===e)return-1;if(e!==n)return nr(e,n)}while(++t)}compareBuild(r){r instanceof e||(r=new e(r,this.options));let t=0;do{const e=this.build[t],n=r.build[t];if(Je("build compare",t,e,n),void 0===e&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===e)return-1;if(e!==n)return nr(e,n)}while(++t)}inc(e,r,t){if(e.startsWith("pre")){if(!r&&!1===t)throw new Error("invalid increment argument: identifier is empty");if(r){const e=`-${r}`.match(this.options.loose?er[rr.PRERELEASELOOSE]:er[rr.PRERELEASE]);if(!e||e[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,t),this.inc("pre",r,t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",r,t),this.inc("pre",r,t);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(t)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(r===this.prerelease.join(".")&&!1===t)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(r){let n=[r,e];!1===t&&(n=[r]),0===nr(this.prerelease[0],r)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const sr=ir;var or=(e,r,t=!1)=>{if(e instanceof sr)return e;try{return new sr(e,r)}catch(e){if(!t)return null;throw e}};const ar=or;var cr=(e,r)=>{const t=ar(e,r);return t?t.version:null};const ur=or;var lr=(e,r)=>{const t=ur(e.trim().replace(/^[=v]+/,""),r);return t?t.version:null};const fr=ir;var pr=(e,r,t,n,i)=>{"string"==typeof t&&(i=n,n=t,t=void 0);try{return new fr(e instanceof fr?e.version:e,t).inc(r,n,i).version}catch(e){return null}};const hr=or;var mr=(e,r)=>{const t=hr(e,null,!0),n=hr(r,null,!0),i=t.compare(n);if(0===i)return null;const s=i>0,o=s?t:n,a=s?n:t,c=!!o.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(0===a.compareMain(o))return a.minor&&!a.patch?"minor":"patch"}const u=c?"pre":"";return t.major!==n.major?u+"major":t.minor!==n.minor?u+"minor":t.patch!==n.patch?u+"patch":"prerelease"};const Er=ir;var vr=(e,r)=>new Er(e,r).major;const dr=ir;var yr=(e,r)=>new dr(e,r).minor;const gr=ir;var Sr=(e,r)=>new gr(e,r).patch;const wr=or;var $r=(e,r)=>{const t=wr(e,r);return t&&t.prerelease.length?t.prerelease:null};const br=ir;var Rr=(e,r,t)=>new br(e,t).compare(new br(r,t));const Ir=Rr;var Or=(e,r,t)=>Ir(r,e,t);const Ar=Rr;var Lr=(e,r)=>Ar(e,r,!0);const Nr=ir;var Tr=(e,r,t)=>{const n=new Nr(e,t),i=new Nr(r,t);return n.compare(i)||n.compareBuild(i)};const Pr=Tr;var jr=(e,r)=>e.sort((e,t)=>Pr(e,t,r));const Cr=Tr;var Dr=(e,r)=>e.sort((e,t)=>Cr(t,e,r));const _r=Rr;var Mr=(e,r,t)=>_r(e,r,t)>0;const xr=Rr;var kr=(e,r,t)=>xr(e,r,t)<0;const Gr=Rr;var Fr=(e,r,t)=>0===Gr(e,r,t);const Ur=Rr;var Br=(e,r,t)=>0!==Ur(e,r,t);const Xr=Rr;var Hr=(e,r,t)=>Xr(e,r,t)>=0;const Kr=Rr;var Vr=(e,r,t)=>Kr(e,r,t)<=0;const qr=Fr,Wr=Br,zr=Mr,Yr=Hr,Jr=kr,Zr=Vr;var Qr=(e,r,t,n)=>{switch(r){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof t&&(t=t.version),e===t;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof t&&(t=t.version),e!==t;case"":case"=":case"==":return qr(e,t,n);case"!=":return Wr(e,t,n);case">":return zr(e,t,n);case">=":return Yr(e,t,n);case"<":return Jr(e,t,n);case"<=":return Zr(e,t,n);default:throw new TypeError(`Invalid operator: ${r}`)}};const et=ir,rt=or,{safeRe:tt,t:nt}=He;var it=(e,r)=>{if(e instanceof et)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let t=null;if((r=r||{}).rtl){const n=r.includePrerelease?tt[nt.COERCERTLFULL]:tt[nt.COERCERTL];let i;for(;(i=n.exec(e))&&(!t||t.index+t[0].length!==e.length);)t&&i.index+i[0].length===t.index+t[0].length||(t=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else t=e.match(r.includePrerelease?tt[nt.COERCEFULL]:tt[nt.COERCE]);if(null===t)return null;const n=t[2],i=t[3]||"0",s=t[4]||"0",o=r.includePrerelease&&t[5]?`-${t[5]}`:"",a=r.includePrerelease&&t[6]?`+${t[6]}`:"";return rt(`${n}.${i}.${s}${o}${a}`,r)};var st,ot,at,ct,ut=class{constructor(){this.max=1e3,this.map=new Map}get(e){const r=this.map.get(e);return void 0===r?void 0:(this.map.delete(e),this.map.set(e,r),r)}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&void 0!==r){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,r)}return this}};function lt(){if(ot)return st;ot=1;const e=/\s+/g;class r{constructor(t,s){if(s=n(s),t instanceof r)return t.loose===!!s.loose&&t.includePrerelease===!!s.includePrerelease?t:new r(t.raw,s);if(t instanceof i)return this.raw=t.value,this.set=[[t]],this.formatted=void 0,this;if(this.options=s,this.loose=!!s.loose,this.includePrerelease=!!s.includePrerelease,this.raw=t.trim().replace(e," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!m(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&E(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const r=this.set[e];for(let e=0;e<r.length;e++)e>0&&(this.formatted+=" "),this.formatted+=r[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const r=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+e,n=t.get(r);if(n)return n;const o=this.options.loose,E=o?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];e=e.replace(E,A(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(a[c.COMPARATORTRIM],u),s("comparator trim",e),e=e.replace(a[c.TILDETRIM],l),s("tilde trim",e),e=e.replace(a[c.CARETTRIM],f),s("caret trim",e);let v=e.split(" ").map(e=>d(e,this.options)).join(" ").split(/\s+/).map(e=>O(e,this.options));o&&(v=v.filter(e=>(s("loose invalid filter",e,this.options),!!e.match(a[c.COMPARATORLOOSE])))),s("range list",v);const y=new Map,g=v.map(e=>new i(e,this.options));for(const e of g){if(m(e))return[e];y.set(e.value,e)}y.size>1&&y.has("")&&y.delete("");const S=[...y.values()];return t.set(r,S),S}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new o(e,this.options)}catch(e){return!1}for(let r=0;r<this.set.length;r++)if(L(this.set[r],e,this.options))return!0;return!1}}st=r;const t=new ut,n=qe,i=ft(),s=Xe,o=ir,{safeRe:a,t:c,comparatorTrimReplace:u,tildeTrimReplace:l,caretTrimReplace:f}=He,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=Be,m=e=>"<0.0.0-0"===e.value,E=e=>""===e.value,v=(e,r)=>{let t=!0;const n=e.slice();let i=n.pop();for(;t&&n.length;)t=n.every(e=>i.intersects(e,r)),i=n.pop();return t},d=(e,r)=>(e=e.replace(a[c.BUILD],""),s("comp",e,r),e=w(e,r),s("caret",e),e=g(e,r),s("tildes",e),e=b(e,r),s("xrange",e),e=I(e,r),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,g=(e,r)=>e.trim().split(/\s+/).map(e=>S(e,r)).join(" "),S=(e,r)=>{const t=r.loose?a[c.TILDELOOSE]:a[c.TILDE];return e.replace(t,(r,t,n,i,o)=>{let a;return s("tilde",e,r,t,n,i,o),y(t)?a="":y(n)?a=`>=${t}.0.0 <${+t+1}.0.0-0`:y(i)?a=`>=${t}.${n}.0 <${t}.${+n+1}.0-0`:o?(s("replaceTilde pr",o),a=`>=${t}.${n}.${i}-${o} <${t}.${+n+1}.0-0`):a=`>=${t}.${n}.${i} <${t}.${+n+1}.0-0`,s("tilde return",a),a})},w=(e,r)=>e.trim().split(/\s+/).map(e=>$(e,r)).join(" "),$=(e,r)=>{s("caret",e,r);const t=r.loose?a[c.CARETLOOSE]:a[c.CARET],n=r.includePrerelease?"-0":"";return e.replace(t,(r,t,i,o,a)=>{let c;return s("caret",e,r,t,i,o,a),y(t)?c="":y(i)?c=`>=${t}.0.0${n} <${+t+1}.0.0-0`:y(o)?c="0"===t?`>=${t}.${i}.0${n} <${t}.${+i+1}.0-0`:`>=${t}.${i}.0${n} <${+t+1}.0.0-0`:a?(s("replaceCaret pr",a),c="0"===t?"0"===i?`>=${t}.${i}.${o}-${a} <${t}.${i}.${+o+1}-0`:`>=${t}.${i}.${o}-${a} <${t}.${+i+1}.0-0`:`>=${t}.${i}.${o}-${a} <${+t+1}.0.0-0`):(s("no pr"),c="0"===t?"0"===i?`>=${t}.${i}.${o}${n} <${t}.${i}.${+o+1}-0`:`>=${t}.${i}.${o}${n} <${t}.${+i+1}.0-0`:`>=${t}.${i}.${o} <${+t+1}.0.0-0`),s("caret return",c),c})},b=(e,r)=>(s("replaceXRanges",e,r),e.split(/\s+/).map(e=>R(e,r)).join(" ")),R=(e,r)=>{e=e.trim();const t=r.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return e.replace(t,(t,n,i,o,a,c)=>{s("xRange",e,t,n,i,o,a,c);const u=y(i),l=u||y(o),f=l||y(a),p=f;return"="===n&&p&&(n=""),c=r.includePrerelease?"-0":"",u?t=">"===n||"<"===n?"<0.0.0-0":"*":n&&p?(l&&(o=0),a=0,">"===n?(n=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):"<="===n&&(n="<",l?i=+i+1:o=+o+1),"<"===n&&(c="-0"),t=`${n+i}.${o}.${a}${c}`):l?t=`>=${i}.0.0${c} <${+i+1}.0.0-0`:f&&(t=`>=${i}.${o}.0${c} <${i}.${+o+1}.0-0`),s("xRange return",t),t})},I=(e,r)=>(s("replaceStars",e,r),e.trim().replace(a[c.STAR],"")),O=(e,r)=>(s("replaceGTE0",e,r),e.trim().replace(a[r.includePrerelease?c.GTE0PRE:c.GTE0],"")),A=e=>(r,t,n,i,s,o,a,c,u,l,f,p)=>`${t=y(n)?"":y(i)?`>=${n}.0.0${e?"-0":""}`:y(s)?`>=${n}.${i}.0${e?"-0":""}`:o?`>=${t}`:`>=${t}${e?"-0":""}`} ${c=y(u)?"":y(l)?`<${+u+1}.0.0-0`:y(f)?`<${u}.${+l+1}.0-0`:p?`<=${u}.${l}.${f}-${p}`:e?`<${u}.${l}.${+f+1}-0`:`<=${c}`}`.trim(),L=(e,r,t)=>{for(let t=0;t<e.length;t++)if(!e[t].test(r))return!1;if(r.prerelease.length&&!t.includePrerelease){for(let t=0;t<e.length;t++)if(s(e[t].semver),e[t].semver!==i.ANY&&e[t].semver.prerelease.length>0){const n=e[t].semver;if(n.major===r.major&&n.minor===r.minor&&n.patch===r.patch)return!0}return!1}return!0};return st}function ft(){if(ct)return at;ct=1;const e=Symbol("SemVer ANY");class r{static get ANY(){return e}constructor(n,i){if(i=t(i),n instanceof r){if(n.loose===!!i.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),o("comparator",n,i),this.options=i,this.loose=!!i.loose,this.parse(n),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(r){const t=this.options.loose?n[i.COMPARATORLOOSE]:n[i.COMPARATOR],s=r.match(t);if(!s)throw new TypeError(`Invalid comparator: ${r}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new a(s[2],this.options.loose):this.semver=e}toString(){return this.value}test(r){if(o("Comparator.test",r,this.options.loose),this.semver===e||r===e)return!0;if("string"==typeof r)try{r=new a(r,this.options)}catch(e){return!1}return s(r,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof r))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,n).test(this.value):""===e.operator?""===e.value||new c(this.value,n).test(e.semver):(!(n=t(n)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(s(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(s(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}at=r;const t=qe,{safeRe:n,t:i}=He,s=Qr,o=Xe,a=ir,c=lt();return at}const pt=lt();var ht=(e,r,t)=>{try{r=new pt(r,t)}catch(e){return!1}return r.test(e)};const mt=lt();var Et=(e,r)=>new mt(e,r).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "));const vt=ir,dt=lt();var yt=(e,r,t)=>{let n=null,i=null,s=null;try{s=new dt(r,t)}catch(e){return null}return e.forEach(e=>{s.test(e)&&(n&&-1!==i.compare(e)||(n=e,i=new vt(n,t)))}),n};const gt=ir,St=lt();var wt=(e,r,t)=>{let n=null,i=null,s=null;try{s=new St(r,t)}catch(e){return null}return e.forEach(e=>{s.test(e)&&(n&&1!==i.compare(e)||(n=e,i=new gt(n,t)))}),n};const $t=ir,bt=lt(),Rt=Mr;var It=(e,r)=>{e=new bt(e,r);let t=new $t("0.0.0");if(e.test(t))return t;if(t=new $t("0.0.0-0"),e.test(t))return t;t=null;for(let r=0;r<e.set.length;++r){const n=e.set[r];let i=null;n.forEach(e=>{const r=new $t(e.semver.version);switch(e.operator){case">":0===r.prerelease.length?r.patch++:r.prerelease.push(0),r.raw=r.format();case"":case">=":i&&!Rt(r,i)||(i=r);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),!i||t&&!Rt(t,i)||(t=i)}return t&&e.test(t)?t:null};const Ot=lt();var At=(e,r)=>{try{return new Ot(e,r).range||"*"}catch(e){return null}};const Lt=ir,Nt=ft(),{ANY:Tt}=Nt,Pt=lt(),jt=ht,Ct=Mr,Dt=kr,_t=Vr,Mt=Hr;var xt=(e,r,t,n)=>{let i,s,o,a,c;switch(e=new Lt(e,n),r=new Pt(r,n),t){case">":i=Ct,s=_t,o=Dt,a=">",c=">=";break;case"<":i=Dt,s=Mt,o=Ct,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(jt(e,r,n))return!1;for(let t=0;t<r.set.length;++t){const u=r.set[t];let l=null,f=null;if(u.forEach(e=>{e.semver===Tt&&(e=new Nt(">=0.0.0")),l=l||e,f=f||e,i(e.semver,l.semver,n)?l=e:o(e.semver,f.semver,n)&&(f=e)}),l.operator===a||l.operator===c)return!1;if((!f.operator||f.operator===a)&&s(e,f.semver))return!1;if(f.operator===c&&o(e,f.semver))return!1}return!0};const kt=xt;var Gt=(e,r,t)=>kt(e,r,">",t);const Ft=xt;var Ut=(e,r,t)=>Ft(e,r,"<",t);const Bt=lt();var Xt=(e,r,t)=>(e=new Bt(e,t),r=new Bt(r,t),e.intersects(r,t));const Ht=ht,Kt=Rr;const Vt=lt(),qt=ft(),{ANY:Wt}=qt,zt=ht,Yt=Rr,Jt=[new qt(">=0.0.0-0")],Zt=[new qt(">=0.0.0")],Qt=(e,r,t)=>{if(e===r)return!0;if(1===e.length&&e[0].semver===Wt){if(1===r.length&&r[0].semver===Wt)return!0;e=t.includePrerelease?Jt:Zt}if(1===r.length&&r[0].semver===Wt){if(t.includePrerelease)return!0;r=Zt}const n=new Set;let i,s,o,a,c,u,l;for(const r of e)">"===r.operator||">="===r.operator?i=en(i,r,t):"<"===r.operator||"<="===r.operator?s=rn(s,r,t):n.add(r.semver);if(n.size>1)return null;if(i&&s){if(o=Yt(i.semver,s.semver,t),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==s.operator))return null}for(const e of n){if(i&&!zt(e,String(i),t))return null;if(s&&!zt(e,String(s),t))return null;for(const n of r)if(!zt(e,String(n),t))return!1;return!0}let f=!(!s||t.includePrerelease||!s.semver.prerelease.length)&&s.semver,p=!(!i||t.includePrerelease||!i.semver.prerelease.length)&&i.semver;f&&1===f.prerelease.length&&"<"===s.operator&&0===f.prerelease[0]&&(f=!1);for(const e of r){if(l=l||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,i)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),">"===e.operator||">="===e.operator){if(a=en(i,e,t),a===e&&a!==i)return!1}else if(">="===i.operator&&!zt(i.semver,String(e),t))return!1;if(s)if(f&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===f.major&&e.semver.minor===f.minor&&e.semver.patch===f.patch&&(f=!1),"<"===e.operator||"<="===e.operator){if(c=rn(s,e,t),c===e&&c!==s)return!1}else if("<="===s.operator&&!zt(s.semver,String(e),t))return!1;if(!e.operator&&(s||i)&&0!==o)return!1}return!(i&&u&&!s&&0!==o)&&(!(s&&l&&!i&&0!==o)&&(!p&&!f))},en=(e,r,t)=>{if(!e)return r;const n=Yt(e.semver,r.semver,t);return n>0?e:n<0||">"===r.operator&&">="===e.operator?r:e},rn=(e,r,t)=>{if(!e)return r;const n=Yt(e.semver,r.semver,t);return n<0?e:n>0||"<"===r.operator&&"<="===e.operator?r:e};var tn=(e,r,t={})=>{if(e===r)return!0;e=new Vt(e,t),r=new Vt(r,t);let n=!1;e:for(const i of e.set){for(const e of r.set){const r=Qt(i,e,t);if(n=n||null!==r,r)continue e}if(n)return!1}return!0};const nn=He,sn=Be,on=ir,an=Ye,cn=(e,r,t)=>{const n=[];let i=null,s=null;const o=e.sort((e,r)=>Kt(e,r,t));for(const e of o){Ht(e,r,t)?(s=e,i||(i=e)):(s&&n.push([i,s]),s=null,i=null)}i&&n.push([i,null]);const a=[];for(const[e,r]of n)e===r?a.push(e):r||e!==o[0]?r?e===o[0]?a.push(`<=${r}`):a.push(`${e} - ${r}`):a.push(`>=${e}`):a.push("*");const c=a.join(" || "),u="string"==typeof r.raw?r.raw:String(r);return c.length<u.length?c:r};var un={parse:or,valid:cr,clean:lr,inc:pr,diff:mr,major:vr,minor:yr,patch:Sr,prerelease:$r,compare:Rr,rcompare:Or,compareLoose:Lr,compareBuild:Tr,sort:jr,rsort:Dr,gt:Mr,lt:kr,eq:Fr,neq:Br,gte:Hr,lte:Vr,cmp:Qr,coerce:it,Comparator:ft(),Range:lt(),satisfies:ht,toComparators:Et,maxSatisfying:yt,minSatisfying:wt,minVersion:It,validRange:At,outside:xt,gtr:Gt,ltr:Ut,intersects:Xt,simplifyRange:cn,subset:tn,SemVer:on,re:nn.re,src:nn.src,tokens:nn.t,SEMVER_SPEC_VERSION:sn.SEMVER_SPEC_VERSION,RELEASE_TYPES:sn.RELEASE_TYPES,compareIdentifiers:an.compareIdentifiers,rcompareIdentifiers:an.rcompareIdentifiers};var ln=un.satisfies(process.version,">=15.7.0");var fn=un.satisfies(process.version,">=16.9.0");const pn=ln,hn=fn,mn={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},En={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};var vn=function(e,r){if(!e||!r)return;const t=r.asymmetricKeyType;if(!t)return;const n=mn[t];if(!n)throw new Error(`Unknown key type "${t}".`);if(!n.includes(e))throw new Error(`"alg" parameter for "${t}" key type must be one of: ${n.join(", ")}.`);if(pn)switch(t){case"ec":const t=r.asymmetricKeyDetails.namedCurve,n=En[e];if(t!==n)throw new Error(`"alg" parameter "${e}" requires curve "${n}".`);break;case"rsa-pss":if(hn){const t=parseInt(e.slice(-3),10),{hashAlgorithm:n,mgf1HashAlgorithm:i,saltLength:s}=r.asymmetricKeyDetails;if(n!==`sha${t}`||i!==n)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==s&&s>t>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}},dn=un.satisfies(process.version,"^6.12.0 || >=8.0.0");const yn=Ie,gn=Le,Sn=Pe,wn=be,$n=Fe,bn=vn,Rn=dn,In=s,{KeyObject:On,createSecretKey:An,createPublicKey:Ln}=n,Nn=["RS256","RS384","RS512"],Tn=["ES256","ES384","ES512"],Pn=["RS256","RS384","RS512"],jn=["HS256","HS384","HS512"];Rn&&(Nn.splice(Nn.length,0,"PS256","PS384","PS512"),Pn.splice(Pn.length,0,"PS256","PS384","PS512"));var Cn=1/0,Dn=9007199254740991,_n=17976931348623157e292,Mn=NaN,xn="[object Arguments]",kn="[object Function]",Gn="[object GeneratorFunction]",Fn="[object String]",Un="[object Symbol]",Bn=/^\s+|\s+$/g,Xn=/^[-+]0x[0-9a-f]+$/i,Hn=/^0b[01]+$/i,Kn=/^0o[0-7]+$/i,Vn=/^(?:0|[1-9]\d*)$/,qn=parseInt;function Wn(e){return e!=e}function zn(e,r){return function(e,r){for(var t=-1,n=e?e.length:0,i=Array(n);++t<n;)i[t]=r(e[t],t,e);return i}(r,function(r){return e[r]})}var Yn,Jn,Zn=Object.prototype,Qn=Zn.hasOwnProperty,ei=Zn.toString,ri=Zn.propertyIsEnumerable,ti=(Yn=Object.keys,Jn=Object,function(e){return Yn(Jn(e))}),ni=Math.max;function ii(e,r){var t=ai(e)||function(e){return function(e){return li(e)&&ci(e)}(e)&&Qn.call(e,"callee")&&(!ri.call(e,"callee")||ei.call(e)==xn)}(e)?function(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}(e.length,String):[],n=t.length,i=!!n;for(var s in e)!r&&!Qn.call(e,s)||i&&("length"==s||oi(s,n))||t.push(s);return t}function si(e){if(t=(r=e)&&r.constructor,n="function"==typeof t&&t.prototype||Zn,r!==n)return ti(e);var r,t,n,i=[];for(var s in Object(e))Qn.call(e,s)&&"constructor"!=s&&i.push(s);return i}function oi(e,r){return!!(r=null==r?Dn:r)&&("number"==typeof e||Vn.test(e))&&e>-1&&e%1==0&&e<r}var ai=Array.isArray;function ci(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Dn}(e.length)&&!function(e){var r=ui(e)?ei.call(e):"";return r==kn||r==Gn}(e)}function ui(e){var r=typeof e;return!!e&&("object"==r||"function"==r)}function li(e){return!!e&&"object"==typeof e}var fi=function(e,r,t,n){var i;e=ci(e)?e:(i=e)?zn(i,function(e){return ci(e)?ii(e):si(e)}(i)):[],t=t&&!n?function(e){var r=function(e){if(!e)return 0===e?e:0;if(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||li(e)&&ei.call(e)==Un}(e))return Mn;if(ui(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=ui(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Bn,"");var t=Hn.test(e);return t||Kn.test(e)?qn(e.slice(2),t?2:8):Xn.test(e)?Mn:+e}(e),e===Cn||e===-1/0){return(e<0?-1:1)*_n}return e==e?e:0}(e),t=r%1;return r==r?t?r-t:r:0}(t):0;var s=e.length;return t<0&&(t=ni(s+t,0)),function(e){return"string"==typeof e||!ai(e)&&li(e)&&ei.call(e)==Fn}(e)?t<=s&&e.indexOf(r,t)>-1:!!s&&function(e,r,t){if(r!=r)return function(e,r,t,n){for(var i=e.length,s=t+(n?1:-1);n?s--:++s<i;)if(r(e[s],s,e))return s;return-1}(e,Wn,t);for(var n=t-1,i=e.length;++n<i;)if(e[n]===r)return n;return-1}(e,r,t)>-1},pi=Object.prototype.toString;var hi=function(e){return!0===e||!1===e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Boolean]"==pi.call(e)},mi=1/0,Ei=17976931348623157e292,vi=NaN,di="[object Symbol]",yi=/^\s+|\s+$/g,gi=/^[-+]0x[0-9a-f]+$/i,Si=/^0b[01]+$/i,wi=/^0o[0-7]+$/i,$i=parseInt,bi=Object.prototype.toString;function Ri(e){var r=typeof e;return!!e&&("object"==r||"function"==r)}var Ii=function(e){return"number"==typeof e&&e==function(e){var r=function(e){if(!e)return 0===e?e:0;if(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&bi.call(e)==di}(e))return vi;if(Ri(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=Ri(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(yi,"");var t=Si.test(e);return t||wi.test(e)?$i(e.slice(2),t?2:8):gi.test(e)?vi:+e}(e),e===mi||e===-1/0){return(e<0?-1:1)*Ei}return e==e?e:0}(e),t=r%1;return r==r?t?r-t:r:0}(e)};Object.prototype.toString;var Oi=Function.prototype,Ai=Object.prototype,Li=Oi.toString,Ni=Ai.hasOwnProperty,Ti=Li.call(Object),Pi=Ai.toString,ji=function(e,r){return function(t){return e(r(t))}}(Object.getPrototypeOf,Object);var Ci=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=Pi.call(e)||function(e){var r=!1;if(null!=e&&"function"!=typeof e.toString)try{r=!!(e+"")}catch(e){}return r}(e))return!1;var r=ji(e);if(null===r)return!0;var t=Ni.call(r,"constructor")&&r.constructor;return"function"==typeof t&&t instanceof t&&Li.call(t)==Ti},Di=Object.prototype.toString,_i=Array.isArray;var Mi=function(e){return"string"==typeof e||!_i(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==Di.call(e)};parseInt,Object.prototype.toString;const xi=dn,ki=fi,Gi=hi,Fi=Ii,Ui=Ci,Bi=Mi,{KeyObject:Xi,createSecretKey:Hi,createPrivateKey:Ki}=n,Vi=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];xi&&Vi.splice(3,0,"PS256","PS384","PS512");ki.bind(null,Vi);var qi=function(e,r,t,n){let i;if("function"!=typeof t||n||(n=t,t={}),t||(t={}),t=Object.assign({},t),i=n||function(e,r){if(e)throw e;return r},t.clockTimestamp&&"number"!=typeof t.clockTimestamp)return i(new yn("clockTimestamp must be a number"));if(void 0!==t.nonce&&("string"!=typeof t.nonce||""===t.nonce.trim()))return i(new yn("nonce must be a non-empty string"));if(void 0!==t.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof t.allowInvalidAsymmetricKeyTypes)return i(new yn("allowInvalidAsymmetricKeyTypes must be a boolean"));const s=t.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return i(new yn("jwt must be provided"));if("string"!=typeof e)return i(new yn("jwt must be a string"));const o=e.split(".");if(3!==o.length)return i(new yn("jwt malformed"));let a;try{a=wn(e,{complete:!0})}catch(e){return i(e)}if(!a)return i(new yn("invalid token"));const c=a.header;let u;if("function"==typeof r){if(!n)return i(new yn("verify must be called asynchronous if secret or public key is provided as a callback"));u=r}else u=function(e,t){return t(null,r)};return u(c,function(r,n){if(r)return i(new yn("error in secret or public key callback: "+r.message));const u=""!==o[2].trim();if(!u&&n)return i(new yn("jwt signature is required"));if(u&&!n)return i(new yn("secret or public key must be provided"));if(!u&&!t.algorithms)return i(new yn('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=n&&!(n instanceof On))try{n=Ln(n)}catch(e){try{n=An("string"==typeof n?Buffer.from(n):n)}catch(e){return i(new yn("secretOrPublicKey is not valid key material"))}}if(t.algorithms||("secret"===n.type?t.algorithms=jn:["rsa","rsa-pss"].includes(n.asymmetricKeyType)?t.algorithms=Pn:"ec"===n.asymmetricKeyType?t.algorithms=Tn:t.algorithms=Nn),-1===t.algorithms.indexOf(a.header.alg))return i(new yn("invalid algorithm"));if(c.alg.startsWith("HS")&&"secret"!==n.type)return i(new yn(`secretOrPublicKey must be a symmetric key when using ${c.alg}`));if(/^(?:RS|PS|ES)/.test(c.alg)&&"public"!==n.type)return i(new yn(`secretOrPublicKey must be an asymmetric key when using ${c.alg}`));if(!t.allowInvalidAsymmetricKeyTypes)try{bn(c.alg,n)}catch(e){return i(e)}let l;try{l=In.verify(e,a.header.alg,n)}catch(e){return i(e)}if(!l)return i(new yn("invalid signature"));const f=a.payload;if(void 0!==f.nbf&&!t.ignoreNotBefore){if("number"!=typeof f.nbf)return i(new yn("invalid nbf value"));if(f.nbf>s+(t.clockTolerance||0))return i(new gn("jwt not active",new Date(1e3*f.nbf)))}if(void 0!==f.exp&&!t.ignoreExpiration){if("number"!=typeof f.exp)return i(new yn("invalid exp value"));if(s>=f.exp+(t.clockTolerance||0))return i(new Sn("jwt expired",new Date(1e3*f.exp)))}if(t.audience){const e=Array.isArray(t.audience)?t.audience:[t.audience];if(!(Array.isArray(f.aud)?f.aud:[f.aud]).some(function(r){return e.some(function(e){return e instanceof RegExp?e.test(r):e===r})}))return i(new yn("jwt audience invalid. expected: "+e.join(" or ")))}if(t.issuer){if("string"==typeof t.issuer&&f.iss!==t.issuer||Array.isArray(t.issuer)&&-1===t.issuer.indexOf(f.iss))return i(new yn("jwt issuer invalid. expected: "+t.issuer))}if(t.subject&&f.sub!==t.subject)return i(new yn("jwt subject invalid. expected: "+t.subject));if(t.jwtid&&f.jti!==t.jwtid)return i(new yn("jwt jwtid invalid. expected: "+t.jwtid));if(t.nonce&&f.nonce!==t.nonce)return i(new yn("jwt nonce invalid. expected: "+t.nonce));if(t.maxAge){if("number"!=typeof f.iat)return i(new yn("iat required when maxAge is specified"));const e=$n(t.maxAge,f.iat);if(void 0===e)return i(new yn('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(s>=e+(t.clockTolerance||0))return i(new Sn("maxAge exceeded",new Date(1e3*e)))}if(!0===t.complete){const e=a.signature;return i(null,{header:c,payload:f,signature:e})}return i(null,f)})};var Wi=Object.freeze({__proto__:null,createOAuthMiddleware:({services:e,database:r,getSchema:t,env:n})=>{const i=n.SECRET||process.env.SECRET||"secret-key-fallback";return async(e,t,n)=>{try{const s=e.headers.authorization;if(!s)return n();if(!s.startsWith("Bearer "))return t.status(401).json({error:"unauthorized",error_description:"Invalid Authorization header"});const o=s.split(" ")[1];let a;try{a=qi(o,i)}catch(e){a=null}if(a&&"directus"===a.iss)return n();const c=await r("oauth_access_tokens").where({access_token:o}).first();if(!c)return t.status(401).json({error:"invalid_token",error_description:"Token not found or revoked"});if(new Date(c.expires_at)<new Date)return t.status(401).json({error:"invalid_token",error_description:"Token expired"});e.oauth={user_id:c.user_id,client_id:c.client_id,scopes:c.scopes||[],token_id:c.id},e.accountability={...e.accountability,user:c.user_id,role:null},n()}catch(e){return console.error("OAuth Middleware Error:",e),t.status(500).json({error:"server_error",error_description:"Internal validation error"})}}}});export{i as default};
