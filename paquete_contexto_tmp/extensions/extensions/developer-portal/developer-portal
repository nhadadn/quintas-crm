import r from"crypto";let t;const e=new Uint8Array(16);function o(){if(!t&&(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const n=[];for(let r=0;r<256;++r)n.push((r+256).toString(16).slice(1));var s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function i(r,t,e){if(s.randomUUID&&!t&&!r)return s.randomUUID();const i=(r=r||{}).random||(r.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){e=e||0;for(let r=0;r<16;++r)t[e+r]=i[r];return t}return function(r,t=0){return n[r[t+0]]+n[r[t+1]]+n[r[t+2]]+n[r[t+3]]+"-"+n[r[t+4]]+n[r[t+5]]+"-"+n[r[t+6]]+n[r[t+7]]+"-"+n[r[t+8]]+n[r[t+9]]+"-"+n[r[t+10]]+n[r[t+11]]+n[r[t+12]]+n[r[t+13]]+n[r[t+14]]+n[r[t+15]]}(i)}console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"),console.log("LOADING DEVELOPER PORTAL EXTENSION - PRODUCTION READY"),console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");var a=(t,e)=>{const{database:o}=e;console.log("REGISTERING DEVELOPER PORTAL ROUTES"),t.get("/ping",(r,t)=>{t.send("pong")}),t.post("/register-app",async(t,e)=>{if(!t.accountability||!t.accountability.user)return e.status(401).json({error:"User not authenticated"});const{name:n,redirect_uris:s,scopes:a}=t.body;if(!n||!s)return e.status(400).json({error:"Missing required fields: name, redirect_uris"});try{const c=i(),u=i(),d=r.randomBytes(32).toString("hex"),l={id:c,client_id:u,client_secret:d,name:n,redirect_uris:JSON.stringify(s),scopes:a?JSON.stringify(a):null,user_created:t.accountability.user,status:"published"};await o("oauth_clients").insert(l),e.json({data:{client_id:u,client_secret:d,name:n,redirect_uris:s,scopes:a||[]}})}catch(r){console.error("Error registering app:",r),e.status(500).json({error:"Internal Server Error",message:r.message})}})};export{a as default};
